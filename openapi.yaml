openapi: 3.0.3
info:
  title: Pictet Analytics API
  description: |
    A Go REST API backend with PostgreSQL for managing teams, rooms, juries, sessions, and room sessions.

    The application follows a clean architecture pattern with clear separation of concerns:
    - **Domain Layer**: Entity definitions (Team, Room, Jury, Session, RoomSession)
    - **Repository Layer**: Data access interfaces and PostgreSQL implementations
    - **Service Layer**: Business logic (with placeholder scheduling and analytics services)
    - **HTTP Layer**: REST API handlers and routing

    **Note**: No authentication/authorization is implemented. Scheduling and analytics are placeholder services.
  version: 1.0.0
  contact:
    name: Pictet Analytics Team
  license:
    name: MIT

servers:
  - url: http://localhost:8080
    description: Local development server
  - url: http://localhost:8080/api
    description: API base path

tags:
  - name: Health
    description: Health check endpoints
  - name: Teams
    description: Operations for managing teams
  - name: Rooms
    description: Operations for managing rooms
  - name: Juries
    description: Operations for managing juries
  - name: Sessions
    description: Operations for managing sessions between teams and juries
  - name: Room Sessions
    description: Operations for linking rooms to sessions
  - name: Scheduling
    description: Placeholder scheduling operations
  - name: Analytics
    description: Placeholder analytics operations

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Returns the health status of the API
      operationId: healthCheck
      responses:
        '200':
          description: API is healthy
          content:
            text/plain:
              schema:
                type: string
                example: OK

  /api/teams:
    post:
      tags:
        - Teams
      summary: Create a new team
      description: Creates a new team with the provided name
      operationId: createTeam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TeamInput'
            examples:
              team:
                summary: Example team
                value:
                  label: Team Alpha
      responses:
        '201':
          description: Team created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'
              examples:
                team:
                  summary: Created team
                  value:
                    id: 1
                    label: Team Alpha
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T10:00:00Z"
        '400':
          description: Invalid request body
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    get:
      tags:
        - Teams
      summary: Get all teams
      description: Retrieves a list of all teams
      operationId: getAllTeams
      responses:
        '200':
          description: List of teams
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Team'
              examples:
                teams:
                  summary: List of teams
                  value:
                    - id: 1
                      label: Team Alpha
                      created_at: "2024-03-01T10:00:00Z"
                      updated_at: "2024-03-01T10:00:00Z"
                    - id: 2
                      label: Team Beta
                      created_at: "2024-03-01T11:00:00Z"
                      updated_at: "2024-03-01T11:00:00Z"
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/teams/{id}:
    get:
      tags:
        - Teams
      summary: Get a team by ID
      description: Retrieves a specific team by its ID
      operationId: getTeamById
      parameters:
        - name: id
          in: path
          required: true
          description: Team ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Team found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'
              examples:
                team:
                  summary: Team details
                  value:
                    id: 1
                    name: Team Alpha
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T10:00:00Z"
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Team not found
          content:
            text/plain:
              schema:
                type: string

    put:
      tags:
        - Teams
      summary: Update an existing team
      description: Updates a team with the provided information. The ID is provided in the URL path, not in the request body.
      operationId: updateTeam
      parameters:
        - name: id
          in: path
          required: true
          description: Team ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TeamInput'
            examples:
              team:
                summary: Updated team
                value:
                  label: Team Alpha Updated
      responses:
        '200':
          description: Team updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'
              examples:
                team:
                  summary: Updated team
                  value:
                    id: 1
                    label: Team Alpha Updated
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T12:00:00Z"
        '400':
          description: Invalid request body or ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    delete:
      tags:
        - Teams
      summary: Delete a team
      description: Deletes a specific team by its ID
      operationId: deleteTeam
      parameters:
        - name: id
          in: path
          required: true
          description: Team ID
          schema:
            type: integer
            example: 1
      responses:
        '204':
          description: Team deleted successfully
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/rooms:
    post:
      tags:
        - Rooms
      summary: Create a new room
      description: Creates a new room with the provided label and max_size
      operationId: createRoom
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoomInput'
            examples:
              room:
                summary: Example room
                value:
                  label: Room 101
                  max_size: 30
      responses:
        '201':
          description: Room created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Room'
              examples:
                room:
                  summary: Created room
                  value:
                    id: 1
                    label: Room 101
                    max_size: 30
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T10:00:00Z"
        '400':
          description: Invalid request body
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    get:
      tags:
        - Rooms
      summary: Get all rooms
      description: Retrieves a list of all rooms
      operationId: getAllRooms
      responses:
        '200':
          description: List of rooms
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Room'
              examples:
                rooms:
                  summary: List of rooms
                  value:
                    - id: 1
                      label: Room 101
                      max_size: 30
                      created_at: "2024-03-01T10:00:00Z"
                      updated_at: "2024-03-01T10:00:00Z"
                    - id: 2
                      label: Room 102
                      max_size: 25
                      created_at: "2024-03-01T11:00:00Z"
                      updated_at: "2024-03-01T11:00:00Z"
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/rooms/{id}:
    get:
      tags:
        - Rooms
      summary: Get a room by ID
      description: Retrieves a specific room by its ID
      operationId: getRoomById
      parameters:
        - name: id
          in: path
          required: true
          description: Room ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Room found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Room'
              examples:
                room:
                  summary: Room details
                  value:
                    id: 1
                    label: Room 101
                    max_size: 30
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T10:00:00Z"
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Room not found
          content:
            text/plain:
              schema:
                type: string

    put:
      tags:
        - Rooms
      summary: Update an existing room
      description: Updates a room with the provided information. The ID is provided in the URL path, not in the request body.
      operationId: updateRoom
      parameters:
        - name: id
          in: path
          required: true
          description: Room ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoomInput'
            examples:
              room:
                summary: Updated room
                value:
                  label: Room 101 Updated
                  max_size: 35
      responses:
        '200':
          description: Room updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Room'
              examples:
                room:
                  summary: Updated room
                  value:
                    id: 1
                    label: Room 101 Updated
                    max_size: 35
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T12:00:00Z"
        '400':
          description: Invalid request body or ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    delete:
      tags:
        - Rooms
      summary: Delete a room
      description: Deletes a specific room by its ID
      operationId: deleteRoom
      parameters:
        - name: id
          in: path
          required: true
          description: Room ID
          schema:
            type: integer
            example: 1
      responses:
        '204':
          description: Room deleted successfully
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/juries:
    post:
      tags:
        - Juries
      summary: Create a new jury
      description: Creates a new jury with the provided name and email
      operationId: createJury
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JuryInput'
            examples:
              jury:
                summary: Example jury
                value:
                  label: Dr. John Smith
      responses:
        '201':
          description: Jury created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Jury'
              examples:
                jury:
                  summary: Created jury
                  value:
                    id: 1
                    label: Dr. John Smith
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T10:00:00Z"
        '400':
          description: Invalid request body
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    get:
      tags:
        - Juries
      summary: Get all juries
      description: Retrieves a list of all juries
      operationId: getAllJuries
      responses:
        '200':
          description: List of juries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Jury'
              examples:
                juries:
                  summary: List of juries
                  value:
                    - id: 1
                      label: Dr. John Smith
                      created_at: "2024-03-01T10:00:00Z"
                      updated_at: "2024-03-01T10:00:00Z"
                    - id: 2
                      label: Prof. Jane Doe
                      created_at: "2024-03-01T11:00:00Z"
                      updated_at: "2024-03-01T11:00:00Z"
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/juries/{id}:
    get:
      tags:
        - Juries
      summary: Get a jury by ID
      description: Retrieves a specific jury by its ID
      operationId: getJuryById
      parameters:
        - name: id
          in: path
          required: true
          description: Jury ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Jury found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Jury'
              examples:
                jury:
                  summary: Jury details
                  value:
                    id: 1
                    name: Dr. John Smith
                    email: john.smith@example.com
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T10:00:00Z"
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Jury not found
          content:
            text/plain:
              schema:
                type: string

    put:
      tags:
        - Juries
      summary: Update an existing jury
      description: Updates a jury with the provided information. The ID is provided in the URL path, not in the request body.
      operationId: updateJury
      parameters:
        - name: id
          in: path
          required: true
          description: Jury ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JuryInput'
            examples:
              jury:
                summary: Updated jury
                value:
                  label: Dr. John Smith Updated
      responses:
        '200':
          description: Jury updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Jury'
              examples:
                jury:
                  summary: Updated jury
                  value:
                    id: 1
                    label: Dr. John Smith Updated
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T12:00:00Z"
        '400':
          description: Invalid request body or ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    delete:
      tags:
        - Juries
      summary: Delete a jury
      description: Deletes a specific jury by its ID
      operationId: deleteJury
      parameters:
        - name: id
          in: path
          required: true
          description: Jury ID
          schema:
            type: integer
            example: 1
      responses:
        '204':
          description: Jury deleted successfully
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/sessions:
    post:
      tags:
        - Sessions
      summary: Create a new session
      description: Creates a new session with label and scheduling parameters
      operationId: createSession
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SessionInput'
            examples:
              session:
                summary: Example session
                value:
                  label: Morning Session
                  start_time: "2024-03-01T09:00:00Z"
                  slot_duration: 60
                  time_between_slots: 15
      responses:
        '201':
          description: Session created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
              examples:
                session:
                  summary: Created session
                  value:
                    id: 1
                    label: Morning Session
                    start_time: "2024-03-01T09:00:00Z"
                    slot_duration: 60
                    time_between_slots: 15
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
        '400':
          description: Invalid request body
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    get:
      tags:
        - Sessions
      summary: Get all sessions
      description: Retrieves a list of all sessions
      operationId: getAllSessions
      responses:
        '200':
          description: List of sessions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Session'
              examples:
                sessions:
                  summary: List of sessions
                  value:
                    - id: 1
                      label: Morning Session
                      start_time: "2024-03-01T09:00:00Z"
                      slot_duration: 60
                      time_between_slots: 15
                      created_at: "2024-03-01T08:00:00Z"
                      updated_at: "2024-03-01T08:00:00Z"
                    - id: 2
                      label: Afternoon Session
                      start_time: "2024-03-01T10:00:00Z"
                      slot_duration: 90
                      time_between_slots: 10
                      created_at: "2024-03-01T08:00:00Z"
                      updated_at: "2024-03-01T08:00:00Z"
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/sessions/{id}:
    get:
      tags:
        - Sessions
      summary: Get a session by ID
      description: Retrieves a specific session by its ID
      operationId: getSessionById
      parameters:
        - name: id
          in: path
          required: true
          description: Session ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Session found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
              examples:
                session:
                  summary: Session details
                  value:
                    id: 1
                    label: Morning Session
                    start_time: "2024-03-01T09:00:00Z"
                    slot_duration: 60
                    time_between_slots: 15
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Session not found
          content:
            text/plain:
              schema:
                type: string

    put:
      tags:
        - Sessions
      summary: Update an existing session
      description: Updates a session with the provided information. The ID is provided in the URL path, not in the request body.
      operationId: updateSession
      parameters:
        - name: id
          in: path
          required: true
          description: Session ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SessionInput'
            examples:
              session:
                summary: Updated session
                value:
                  label: Morning Session Updated
                  start_time: "2024-03-01T09:30:00Z"
                  slot_duration: 90
                  time_between_slots: 20
      responses:
        '200':
          description: Session updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
              examples:
                session:
                  summary: Updated session
                  value:
                    id: 1
                    label: Morning Session Updated
                    start_time: "2024-03-01T09:30:00Z"
                    slot_duration: 90
                    time_between_slots: 20
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T12:00:00Z"
        '400':
          description: Invalid request body or ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    delete:
      tags:
        - Sessions
      summary: Delete a session
      description: Deletes a specific session by its ID
      operationId: deleteSession
      parameters:
        - name: id
          in: path
          required: true
          description: Session ID
          schema:
            type: integer
            example: 1
      responses:
        '204':
          description: Session deleted successfully
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/sessions/{id}/plan:
    post:
      tags:
        - Sessions
      summary: Save a full session plan
      description: |
        Saves a complete session plan including session-level links (rooms, teams, juries) and slots.
        Validates that all IDs exist and that slot team/jury IDs are subsets of the session selections.
        Persists transactionally: upserts session_rooms/session_teams/session_juries, creates/updates room_sessions,
        and creates room_session_teams and room_session_juries rows.
      operationId: saveSessionPlan
      parameters:
        - name: id
          in: path
          required: true
          description: Session ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SessionPlan'
            examples:
              sessionPlan:
                summary: Example session plan
                value:
                  room_ids: [1, 2]
                  team_ids: [1, 2, 3, 4]
                  jury_ids: [1, 2]
                  teams_per_room: 2
                  juries_per_room: 1
                  slots:
                    - room_id: 1
                      start_time: "2024-03-01T09:00:00Z"
                      end_time: "2024-03-01T10:00:00Z"
                      team_ids: [1, 2]
                      jury_ids: [1]
                    - room_id: 2
                      start_time: "2024-03-01T09:00:00Z"
                      end_time: "2024-03-01T10:00:00Z"
                      team_ids: [3, 4]
                      jury_ids: [2]
      responses:
        '200':
          description: Session plan saved successfully
          content:
            text/plain:
              schema:
                type: string
                example: Session plan saved successfully
        '400':
          description: Invalid request body or ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error (e.g., validation failed, IDs not found)
          content:
            text/plain:
              schema:
                type: string

  /api/room-sessions:
    post:
      tags:
        - Room Sessions
      summary: Create a new room session
      description: |
        Creates a new room session linking a room to a session with optional teams and juries.

        When team_ids or jury_ids are provided:
        - Creates the room session
        - Associates teams and juries with the room session
        - Automatically upserts into session_teams, session_juries, and session_rooms if the entities are not already linked to the parent session
        - Returns the room session with expanded data (room, session, teams, juries)

        When team_ids and jury_ids are not provided:
        - Creates a basic room session (backward compatible)
        - Returns the room session without expanded data
      operationId: createRoomSession
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoomSessionInput'
            examples:
              basicRoomSession:
                summary: Basic room session (backward compatible)
                value:
                  room_id: 1
                  session_id: 1
                  start_time: "2024-03-01T09:00:00Z"
                  end_time: "2024-03-01T10:00:00Z"
              roomSessionWithRelations:
                summary: Room session with teams and juries
                value:
                  room_id: 1
                  session_id: 1
                  start_time: "2024-03-01T09:00:00Z"
                  end_time: "2024-03-01T10:00:00Z"
                  team_ids: [1, 2]
                  jury_ids: [1]
      responses:
        '201':
          description: Room session created successfully
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/RoomSession'
                  - $ref: '#/components/schemas/RoomSessionExpanded'
              examples:
                basicRoomSession:
                  summary: Basic room session created
                  value:
                    id: 1
                    room_id: 1
                    session_id: 1
                    start_time: "2024-03-01T09:00:00Z"
                    end_time: "2024-03-01T10:00:00Z"
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
                roomSessionWithRelations:
                  summary: Room session with relations created
                  value:
                    id: 1
                    room_id: 1
                    session_id: 1
                    start_time: "2024-03-01T09:00:00Z"
                    end_time: "2024-03-01T10:00:00Z"
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
                    room:
                      id: 1
                      label: "Room 101"
                    session:
                      id: 1
                      label: "Morning Session"
                    teams:
                      - id: 1
                        label: "Team Alpha"
                      - id: 2
                        label: "Team Beta"
                    juries:
                      - id: 1
                        label: "Jury Smith"
        '400':
          description: Invalid request body
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    get:
      tags:
        - Room Sessions
      summary: Get all room sessions
      description: |
        Retrieves a list of all room sessions. Optionally expand related entities using the expand parameter.

        The expand parameter accepts comma-separated values to include related data:
        - `room`: Include room details (id and label)
        - `session`: Include session details (id and label)
        - `teams`: Include teams associated with the room session
        - `juries`: Include juries associated with the room session
      operationId: getAllRoomSessions
      parameters:
        - name: expand
          in: query
          required: false
          description: Comma-separated list of related entities to expand (room, session, teams, juries)
          schema:
            type: string
            example: "room,session,teams,juries"
      responses:
        '200':
          description: List of room sessions
          content:
            application/json:
              schema:
                type: array
                items:
                  oneOf:
                    - $ref: '#/components/schemas/RoomSession'
                    - $ref: '#/components/schemas/RoomSessionExpanded'
              examples:
                roomSessions:
                  summary: List of room sessions (no expand)
                  value:
                    - id: 1
                      room_id: 1
                      session_id: 1
                      start_time: "2024-03-01T09:00:00Z"
                      end_time: "2024-03-01T10:00:00Z"
                      created_at: "2024-03-01T08:00:00Z"
                      updated_at: "2024-03-01T08:00:00Z"
                    - id: 2
                      room_id: 2
                      session_id: 2
                      start_time: "2024-03-01T10:00:00Z"
                      end_time: "2024-03-01T11:00:00Z"
                      created_at: "2024-03-01T08:00:00Z"
                      updated_at: "2024-03-01T08:00:00Z"
                roomSessionsExpanded:
                  summary: List of room sessions with expand
                  value:
                    - id: 1
                      room_id: 1
                      session_id: 1
                      start_time: "2024-03-01T09:00:00Z"
                      end_time: "2024-03-01T10:00:00Z"
                      created_at: "2024-03-01T08:00:00Z"
                      updated_at: "2024-03-01T08:00:00Z"
                      room:
                        id: 1
                        label: "Room 101"
                      session:
                        id: 1
                        label: "Morning Session"
                      teams:
                        - id: 1
                          label: "Team Alpha"
                        - id: 2
                          label: "Team Beta"
                      juries:
                        - id: 1
                          label: "Jury Smith"
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/room-sessions/{id}:
    get:
      tags:
        - Room Sessions
      summary: Get a room session by ID
      description: |
        Retrieves a specific room session by its ID. Optionally expand related entities using the expand parameter.

        The expand parameter accepts comma-separated values to include related data:
        - `room`: Include room details (id and label)
        - `session`: Include session details (id and label)
        - `teams`: Include teams associated with the room session
        - `juries`: Include juries associated with the room session
      operationId: getRoomSessionById
      parameters:
        - name: id
          in: path
          required: true
          description: Room session ID
          schema:
            type: integer
            example: 1
        - name: expand
          in: query
          required: false
          description: Comma-separated list of related entities to expand (room, session, teams, juries)
          schema:
            type: string
            example: "room,session,teams,juries"
      responses:
        '200':
          description: Room session found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/RoomSession'
                  - $ref: '#/components/schemas/RoomSessionExpanded'
              examples:
                roomSession:
                  summary: Room session details (no expand)
                  value:
                    id: 1
                    room_id: 1
                    session_id: 1
                    start_time: "2024-03-01T09:00:00Z"
                    end_time: "2024-03-01T10:00:00Z"
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
                roomSessionExpanded:
                  summary: Room session details with expand
                  value:
                    id: 1
                    room_id: 1
                    session_id: 1
                    start_time: "2024-03-01T09:00:00Z"
                    end_time: "2024-03-01T10:00:00Z"
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
                    room:
                      id: 1
                      label: "Room 101"
                    session:
                      id: 1
                      label: "Morning Session"
                    teams:
                      - id: 1
                        label: "Team Alpha"
                      - id: 2
                        label: "Team Beta"
                    juries:
                      - id: 1
                        label: "Jury Smith"
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Room session not found
          content:
            text/plain:
              schema:
                type: string

    delete:
      tags:
        - Room Sessions
      summary: Delete a room session
      description: Deletes a specific room session by its ID
      operationId: deleteRoomSession
      parameters:
        - name: id
          in: path
          required: true
          description: Room session ID
          schema:
            type: integer
            example: 1
      responses:
        '204':
          description: Room session deleted successfully
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    put:
      tags:
        - Room Sessions
      summary: Update a room session
      description: |
        Updates a room session with new room/time and replaces team/jury assignments in a transaction.

        This endpoint:
        - Updates the room session with new room_id, session_id, start_time, and end_time
        - Replaces all team and jury associations (removes old ones, adds new ones)
        - Automatically upserts into session_teams, session_juries, and session_rooms if the entities are not already linked to the parent session
        - Returns the updated room session with expanded data (room, session, teams, juries)
      operationId: updateRoomSession
      parameters:
        - name: id
          in: path
          required: true
          description: Room session ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoomSessionUpdateInput'
            examples:
              updateRoomSession:
                summary: Update room session
                value:
                  room_id: 2
                  session_id: 1
                  start_time: "2024-03-01T10:00:00Z"
                  end_time: "2024-03-01T11:00:00Z"
                  team_ids: [3, 4]
                  jury_ids: [2]
      responses:
        '200':
          description: Room session updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoomSessionExpanded'
              examples:
                updatedRoomSession:
                  summary: Updated room session with relations
                  value:
                    id: 1
                    room_id: 2
                    session_id: 1
                    start_time: "2024-03-01T10:00:00Z"
                    end_time: "2024-03-01T11:00:00Z"
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T12:00:00Z"
                    room:
                      id: 2
                      label: "Room 102"
                    session:
                      id: 1
                      label: "Morning Session"
                    teams:
                      - id: 3
                        label: "Team Gamma"
                      - id: 4
                        label: "Team Delta"
                    juries:
                      - id: 2
                        label: "Jury Jones"
        '400':
          description: Invalid request body or ID parameter
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Room session not found
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/scheduling/schedule:
    post:
      tags:
        - Scheduling
      summary: Trigger scheduling
      description: Triggers the scheduling algorithm (placeholder implementation)
      operationId: scheduleSessions
      responses:
        '200':
          description: Scheduling executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Scheduling placeholder executed
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/scheduling/optimize:
    post:
      tags:
        - Scheduling
      summary: Trigger optimization
      description: Triggers the schedule optimization algorithm (placeholder implementation)
      operationId: optimizeSchedule
      responses:
        '200':
          description: Optimization executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Optimization placeholder executed
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/analytics/report:
    get:
      tags:
        - Analytics
      summary: Get analytics report
      description: Generates an analytics report (placeholder implementation)
      operationId: getAnalyticsReport
      responses:
        '200':
          description: Analytics report generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  report:
                    type: string
                    example: Analytics report placeholder
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/analytics/metrics:
    get:
      tags:
        - Analytics
      summary: Get metrics
      description: Retrieves system metrics (placeholder implementation)
      operationId: getMetrics
      responses:
        '200':
          description: Metrics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
                example:
                  metric1: value1
                  metric2: value2
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

components:
  schemas:
    Team:
      type: object
      required:
        - id
        - label
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          description: Team ID
          example: 1
        label:
          type: string
          description: Team label
          example: Team Alpha
        created_at:
          type: string
          format: date-time
          description: Timestamp when the team was created
          example: "2024-03-01T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the team was last updated
          example: "2024-03-01T10:00:00Z"

    TeamInput:
      type: object
      required:
        - label
      properties:
        label:
          type: string
          description: Team label
          example: Team Alpha

    Room:
      type: object
      required:
        - id
        - label
        - max_size
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          description: Room ID
          example: 1
        label:
          type: string
          description: Room label
          example: Room 101
        max_size:
          type: integer
          description: Room maximum capacity (number of people)
          example: 30
        created_at:
          type: string
          format: date-time
          description: Timestamp when the room was created
          example: "2024-03-01T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the room was last updated
          example: "2024-03-01T10:00:00Z"

    RoomInput:
      type: object
      required:
        - label
        - max_size
      properties:
        label:
          type: string
          description: Room label
          example: Room 101
        max_size:
          type: integer
          description: Room maximum capacity (number of people)
          example: 30

    Jury:
      type: object
      required:
        - id
        - label
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          description: Jury ID
          example: 1
        label:
          type: string
          description: Jury member label
          example: Dr. John Smith
        created_at:
          type: string
          format: date-time
          description: Timestamp when the jury was created
          example: "2024-03-01T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the jury was last updated
          example: "2024-03-01T10:00:00Z"

    JuryInput:
      type: object
      required:
        - label
      properties:
        label:
          type: string
          description: Jury member label
          example: Dr. John Smith

    Session:
      type: object
      required:
        - id
        - label
        - start_time
        - slot_duration
        - time_between_slots
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          description: Session ID
          example: 1
        label:
          type: string
          description: Session label
          example: Morning Session
        start_time:
          type: string
          format: date-time
          description: Session start time
          example: "2024-03-01T09:00:00Z"
        slot_duration:
          type: integer
          description: Duration of each slot in minutes
          example: 60
        time_between_slots:
          type: integer
          description: Gap between slots in minutes
          example: 15
        created_at:
          type: string
          format: date-time
          description: Timestamp when the session was created
          example: "2024-03-01T08:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the session was last updated
          example: "2024-03-01T08:00:00Z"

    SessionInput:
      type: object
      required:
        - label
        - start_time
        - slot_duration
        - time_between_slots
      properties:
        label:
          type: string
          description: Session label
          example: Morning Session
        start_time:
          type: string
          format: date-time
          description: Session start time
          example: "2024-03-01T09:00:00Z"
        slot_duration:
          type: integer
          description: Duration of each slot in minutes
          example: 60
        time_between_slots:
          type: integer
          description: Gap between slots in minutes
          example: 15

    RoomSession:
      type: object
      required:
        - id
        - room_id
        - session_id
        - start_time
        - end_time
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          description: Room session ID
          example: 1
        room_id:
          type: integer
          description: ID of the room
          example: 1
        session_id:
          type: integer
          description: ID of the session
          example: 1
        start_time:
          type: string
          format: date-time
          description: Room session start time
          example: "2024-03-01T09:00:00Z"
        end_time:
          type: string
          format: date-time
          description: Room session end time
          example: "2024-03-01T10:00:00Z"
        created_at:
          type: string
          format: date-time
          description: Timestamp when the room session was created
          example: "2024-03-01T08:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the room session was last updated
          example: "2024-03-01T08:00:00Z"

    RoomSessionInput:
      type: object
      required:
        - room_id
        - session_id
        - start_time
        - end_time
      properties:
        room_id:
          type: integer
          description: ID of the room
          example: 1
        session_id:
          type: integer
          description: ID of the session
          example: 1
        start_time:
          type: string
          format: date-time
          description: Room session start time
          example: "2024-03-01T09:00:00Z"
        end_time:
          type: string
          format: date-time
          description: Room session end time
          example: "2024-03-01T10:00:00Z"
        team_ids:
          type: array
          items:
            type: integer
          description: Optional array of team IDs to associate with this room session
          example: [1, 2]
        jury_ids:
          type: array
          items:
            type: integer
          description: Optional array of jury IDs to associate with this room session
          example: [1]

    RoomSessionExpanded:
      type: object
      required:
        - id
        - room_id
        - session_id
        - start_time
        - end_time
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          description: Room session ID
          example: 1
        room_id:
          type: integer
          description: ID of the room
          example: 1
        session_id:
          type: integer
          description: ID of the session
          example: 1
        start_time:
          type: string
          format: date-time
          description: Room session start time
          example: "2024-03-01T09:00:00Z"
        end_time:
          type: string
          format: date-time
          description: Room session end time
          example: "2024-03-01T10:00:00Z"
        created_at:
          type: string
          format: date-time
          description: Timestamp when the room session was created
          example: "2024-03-01T08:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the room session was last updated
          example: "2024-03-01T08:00:00Z"
        room:
          $ref: '#/components/schemas/IDLabel'
        session:
          $ref: '#/components/schemas/IDLabel'
        teams:
          type: array
          items:
            $ref: '#/components/schemas/IDLabel'
          description: Teams associated with this room session
        juries:
          type: array
          items:
            $ref: '#/components/schemas/IDLabel'
          description: Juries associated with this room session

    RoomSessionUpdateInput:
      type: object
      required:
        - room_id
        - session_id
        - start_time
        - end_time
      properties:
        room_id:
          type: integer
          description: ID of the room
          example: 1
        session_id:
          type: integer
          description: ID of the session
          example: 1
        start_time:
          type: string
          format: date-time
          description: Room session start time
          example: "2024-03-01T09:00:00Z"
        end_time:
          type: string
          format: date-time
          description: Room session end time
          example: "2024-03-01T10:00:00Z"
        team_ids:
          type: array
          items:
            type: integer
          description: Array of team IDs to associate with this room session (replaces existing)
          example: [1, 2]
        jury_ids:
          type: array
          items:
            type: integer
          description: Array of jury IDs to associate with this room session (replaces existing)
          example: [1]

    IDLabel:
      type: object
      required:
        - id
        - label
      properties:
        id:
          type: integer
          description: Entity ID
          example: 1
        label:
          type: string
          description: Entity label
          example: "Team Alpha"

    SessionPlan:
      type: object
      required:
        - room_ids
        - team_ids
        - jury_ids
        - teams_per_room
        - juries_per_room
        - slots
      properties:
        room_ids:
          type: array
          items:
            type: integer
          description: IDs of rooms associated with the session
          example: [1, 2]
        team_ids:
          type: array
          items:
            type: integer
          description: IDs of teams associated with the session
          example: [1, 2, 3, 4]
        jury_ids:
          type: array
          items:
            type: integer
          description: IDs of juries associated with the session
          example: [1, 2]
        teams_per_room:
          type: integer
          description: Number of teams per room
          example: 2
        juries_per_room:
          type: integer
          description: Number of juries per room
          example: 1
        slots:
          type: array
          items:
            $ref: '#/components/schemas/SessionPlanSlot'
          description: Array of time slots with room, team, and jury assignments

    SessionPlanSlot:
      type: object
      required:
        - room_id
        - start_time
        - end_time
        - team_ids
        - jury_ids
      properties:
        room_id:
          type: integer
          description: ID of the room for this slot
          example: 1
        start_time:
          type: string
          format: date-time
          description: Slot start time
          example: "2024-03-01T09:00:00Z"
        end_time:
          type: string
          format: date-time
          description: Slot end time
          example: "2024-03-01T10:00:00Z"
        team_ids:
          type: array
          items:
            type: integer
          description: IDs of teams assigned to this slot (must be subset of session team_ids)
          example: [1, 2]
        jury_ids:
          type: array
          items:
            type: integer
          description: IDs of juries assigned to this slot (must be subset of session jury_ids)
          example: [1]
