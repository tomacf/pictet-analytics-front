openapi: 3.0.3
info:
  title: Pictet Analytics API
  description: |
    A Go REST API backend with PostgreSQL for managing teams, rooms, juries, sessions, and room sessions.

    The application follows a clean architecture pattern with clear separation of concerns:
    - **Domain Layer**: Entity definitions (Team, Room, Jury, Session, RoomSession)
    - **Repository Layer**: Data access interfaces and PostgreSQL implementations
    - **Service Layer**: Business logic (with placeholder scheduling and analytics services)
    - **HTTP Layer**: REST API handlers and routing

    **Note**: No authentication/authorization is implemented. Scheduling and analytics are placeholder services.
  version: 1.0.0
  contact:
    name: Pictet Analytics Team
  license:
    name: MIT

servers:
  - url: http://localhost:8080
    description: Local development server
  - url: http://localhost:8080/api
    description: API base path

tags:
  - name: Health
    description: Health check endpoints
  - name: Teams
    description: Operations for managing teams
  - name: Rooms
    description: Operations for managing rooms
  - name: Juries
    description: Operations for managing juries
  - name: Sessions
    description: Operations for managing sessions between teams and juries
  - name: Room Sessions
    description: Operations for linking rooms to sessions
  - name: Scheduling
    description: Placeholder scheduling operations
  - name: Analytics
    description: Placeholder analytics operations
  - name: Import
    description: PDF import operations for session schedules

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Returns the health status of the API
      operationId: healthCheck
      responses:
        '200':
          description: API is healthy
          content:
            text/plain:
              schema:
                type: string
                example: OK

  /api/teams:
    post:
      tags:
        - Teams
      summary: Create a new team
      description: Creates a new team with the provided name
      operationId: createTeam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TeamInput'
            examples:
              team:
                summary: Example team
                value:
                  label: Team Alpha
      responses:
        '201':
          description: Team created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'
              examples:
                team:
                  summary: Created team
                  value:
                    id: 1
                    label: Team Alpha
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T10:00:00Z"
        '400':
          description: Invalid request body
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    get:
      tags:
        - Teams
      summary: Get all teams
      description: Retrieves a list of all teams
      operationId: getAllTeams
      responses:
        '200':
          description: List of teams
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Team'
              examples:
                teams:
                  summary: List of teams
                  value:
                    - id: 1
                      label: Team Alpha
                      created_at: "2024-03-01T10:00:00Z"
                      updated_at: "2024-03-01T10:00:00Z"
                    - id: 2
                      label: Team Beta
                      created_at: "2024-03-01T11:00:00Z"
                      updated_at: "2024-03-01T11:00:00Z"
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/teams/{id}:
    get:
      tags:
        - Teams
      summary: Get a team by ID
      description: Retrieves a specific team by its ID
      operationId: getTeamById
      parameters:
        - name: id
          in: path
          required: true
          description: Team ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Team found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'
              examples:
                team:
                  summary: Team details
                  value:
                    id: 1
                    label: Team Alpha
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T10:00:00Z"
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Team not found
          content:
            text/plain:
              schema:
                type: string

    put:
      tags:
        - Teams
      summary: Update an existing team
      description: Updates a team with the provided information. The ID is provided in the URL path, not in the request body.
      operationId: updateTeam
      parameters:
        - name: id
          in: path
          required: true
          description: Team ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TeamInput'
            examples:
              team:
                summary: Updated team
                value:
                  label: Team Alpha Updated
      responses:
        '200':
          description: Team updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'
              examples:
                team:
                  summary: Updated team
                  value:
                    id: 1
                    label: Team Alpha Updated
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T12:00:00Z"
        '400':
          description: Invalid request body or ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    delete:
      tags:
        - Teams
      summary: Delete a team
      description: Deletes a specific team by its ID
      operationId: deleteTeam
      parameters:
        - name: id
          in: path
          required: true
          description: Team ID
          schema:
            type: integer
            example: 1
      responses:
        '204':
          description: Team deleted successfully
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/rooms:
    post:
      tags:
        - Rooms
      summary: Create a new room
      description: Creates a new room with the provided label and max_size
      operationId: createRoom
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoomInput'
            examples:
              room:
                summary: Example room
                value:
                  label: Room 101
                  max_size: 30
      responses:
        '201':
          description: Room created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Room'
              examples:
                room:
                  summary: Created room
                  value:
                    id: 1
                    label: Room 101
                    max_size: 30
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T10:00:00Z"
        '400':
          description: Invalid request body
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    get:
      tags:
        - Rooms
      summary: Get all rooms
      description: Retrieves a list of all rooms
      operationId: getAllRooms
      responses:
        '200':
          description: List of rooms
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Room'
              examples:
                rooms:
                  summary: List of rooms
                  value:
                    - id: 1
                      label: Room 101
                      max_size: 30
                      created_at: "2024-03-01T10:00:00Z"
                      updated_at: "2024-03-01T10:00:00Z"
                    - id: 2
                      label: Room 102
                      max_size: 25
                      created_at: "2024-03-01T11:00:00Z"
                      updated_at: "2024-03-01T11:00:00Z"
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/rooms/{id}:
    get:
      tags:
        - Rooms
      summary: Get a room by ID
      description: Retrieves a specific room by its ID
      operationId: getRoomById
      parameters:
        - name: id
          in: path
          required: true
          description: Room ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Room found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Room'
              examples:
                room:
                  summary: Room details
                  value:
                    id: 1
                    label: Room 101
                    max_size: 30
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T10:00:00Z"
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Room not found
          content:
            text/plain:
              schema:
                type: string

    put:
      tags:
        - Rooms
      summary: Update an existing room
      description: Updates a room with the provided information. The ID is provided in the URL path, not in the request body.
      operationId: updateRoom
      parameters:
        - name: id
          in: path
          required: true
          description: Room ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoomInput'
            examples:
              room:
                summary: Updated room
                value:
                  label: Room 101 Updated
                  max_size: 35
      responses:
        '200':
          description: Room updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Room'
              examples:
                room:
                  summary: Updated room
                  value:
                    id: 1
                    label: Room 101 Updated
                    max_size: 35
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T12:00:00Z"
        '400':
          description: Invalid request body or ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    delete:
      tags:
        - Rooms
      summary: Delete a room
      description: Deletes a specific room by its ID
      operationId: deleteRoom
      parameters:
        - name: id
          in: path
          required: true
          description: Room ID
          schema:
            type: integer
            example: 1
      responses:
        '204':
          description: Room deleted successfully
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/juries:
    post:
      tags:
        - Juries
      summary: Create a new jury
      description: Creates a new jury with the provided name and email
      operationId: createJury
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JuryInput'
            examples:
              jury:
                summary: Example jury
                value:
                  label: Dr. John Smith
      responses:
        '201':
          description: Jury created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Jury'
              examples:
                jury:
                  summary: Created jury
                  value:
                    id: 1
                    label: Dr. John Smith
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T10:00:00Z"
        '400':
          description: Invalid request body
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    get:
      tags:
        - Juries
      summary: Get all juries
      description: Retrieves a list of all juries
      operationId: getAllJuries
      responses:
        '200':
          description: List of juries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Jury'
              examples:
                juries:
                  summary: List of juries
                  value:
                    - id: 1
                      label: Dr. John Smith
                      created_at: "2024-03-01T10:00:00Z"
                      updated_at: "2024-03-01T10:00:00Z"
                    - id: 2
                      label: Prof. Jane Doe
                      created_at: "2024-03-01T11:00:00Z"
                      updated_at: "2024-03-01T11:00:00Z"
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/juries/{id}:
    get:
      tags:
        - Juries
      summary: Get a jury by ID
      description: Retrieves a specific jury by its ID
      operationId: getJuryById
      parameters:
        - name: id
          in: path
          required: true
          description: Jury ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Jury found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Jury'
              examples:
                jury:
                  summary: Jury details
                  value:
                    id: 1
                    label: Dr. John Smith
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T10:00:00Z"
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Jury not found
          content:
            text/plain:
              schema:
                type: string

    put:
      tags:
        - Juries
      summary: Update an existing jury
      description: Updates a jury with the provided information. The ID is provided in the URL path, not in the request body.
      operationId: updateJury
      parameters:
        - name: id
          in: path
          required: true
          description: Jury ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JuryInput'
            examples:
              jury:
                summary: Updated jury
                value:
                  label: Dr. John Smith Updated
      responses:
        '200':
          description: Jury updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Jury'
              examples:
                jury:
                  summary: Updated jury
                  value:
                    id: 1
                    label: Dr. John Smith Updated
                    created_at: "2024-03-01T10:00:00Z"
                    updated_at: "2024-03-01T12:00:00Z"
        '400':
          description: Invalid request body or ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    delete:
      tags:
        - Juries
      summary: Delete a jury
      description: Deletes a specific jury by its ID
      operationId: deleteJury
      parameters:
        - name: id
          in: path
          required: true
          description: Jury ID
          schema:
            type: integer
            example: 1
      responses:
        '204':
          description: Jury deleted successfully
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/sessions:
    post:
      tags:
        - Sessions
      summary: Create a new session
      description: Creates a new session with label and scheduling parameters
      operationId: createSession
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SessionInput'
            examples:
              session:
                summary: Example session
                value:
                  label: Morning Session
                  start_time: "2024-03-01T09:00:00Z"
                  slot_duration: 60
                  time_between_slots: 15
      responses:
        '201':
          description: Session created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
              examples:
                session:
                  summary: Created session
                  value:
                    id: 1
                    label: Morning Session
                    start_time: "2024-03-01T09:00:00Z"
                    slot_duration: 60
                    time_between_slots: 15
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
        '400':
          description: Invalid request body
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    get:
      tags:
        - Sessions
      summary: Get all sessions
      description: |
        Retrieves a list of all sessions. Supports optional expansion of related data via the `expand` query parameter.

        **Expand Options:**
        - `teams` - Include associated teams (id, label)
        - `juries` - Include associated juries (id, label)
        - `rooms` - Include associated rooms (id, label)
        - `summary` - Include summary statistics (room_sessions_count, first_room_session_start_time, last_room_session_end_time)

        Multiple options can be combined using comma-separated values (e.g., `?expand=teams,juries,summary`)
      operationId: getAllSessions
      parameters:
        - name: expand
          in: query
          required: false
          description: Comma-separated list of fields to expand (teams, juries, rooms, summary)
          schema:
            type: string
            example: "teams,juries,rooms,summary"
      responses:
        '200':
          description: List of sessions
          content:
            application/json:
              schema:
                type: array
                items:
                  oneOf:
                    - $ref: '#/components/schemas/Session'
                    - $ref: '#/components/schemas/SessionExpanded'
              examples:
                sessions:
                  summary: List of sessions without expand
                  value:
                    - id: 1
                      label: Morning Session
                      start_time: "2024-03-01T09:00:00Z"
                      slot_duration: 60
                      time_between_slots: 15
                      created_at: "2024-03-01T08:00:00Z"
                      updated_at: "2024-03-01T08:00:00Z"
                    - id: 2
                      label: Afternoon Session
                      start_time: "2024-03-01T10:00:00Z"
                      slot_duration: 90
                      time_between_slots: 10
                      created_at: "2024-03-01T08:00:00Z"
                      updated_at: "2024-03-01T08:00:00Z"
                expandedSessions:
                  summary: List of sessions with expand=teams,juries,rooms,summary
                  value:
                    - id: 1
                      label: Morning Session
                      start_time: "2024-03-01T09:00:00Z"
                      slot_duration: 60
                      time_between_slots: 15
                      created_at: "2024-03-01T08:00:00Z"
                      updated_at: "2024-03-01T08:00:00Z"
                      teams:
                        - id: 1
                          label: Team Alpha
                        - id: 2
                          label: Team Beta
                      juries:
                        - id: 1
                          label: Dr. John Smith
                      rooms:
                        - id: 1
                          label: Room 101
                        - id: 2
                          label: Room 102
                      room_sessions_count: 4
                      first_room_session_start_time: "2024-03-01T09:00:00Z"
                      last_room_session_end_time: "2024-03-01T12:00:00Z"
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/sessions/{id}:
    get:
      tags:
        - Sessions
      summary: Get a session by ID
      description: |
        Retrieves a specific session by its ID. Supports optional expansion of related data via the `expand` query parameter.

        **Expand Options:**
        - `teams` - Include associated teams (id, label)
        - `juries` - Include associated juries (id, label)
        - `rooms` - Include associated rooms (id, label)
        - `room_sessions` - Include all room sessions for this session with expanded room, teams, and juries
        - `summary` - Include summary statistics (room_sessions_count, first_room_session_start_time, last_room_session_end_time)

        Multiple options can be combined using comma-separated values (e.g., `?expand=teams,juries,rooms,room_sessions`)
      operationId: getSessionById
      parameters:
        - name: id
          in: path
          required: true
          description: Session ID
          schema:
            type: integer
            example: 1
        - name: expand
          in: query
          required: false
          description: Comma-separated list of fields to expand (teams, juries, rooms, room_sessions, summary)
          schema:
            type: string
            example: "teams,juries,rooms,room_sessions"
      responses:
        '200':
          description: Session found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/Session'
                  - $ref: '#/components/schemas/SessionExpanded'
              examples:
                session:
                  summary: Session details without expand
                  value:
                    id: 1
                    label: Morning Session
                    start_time: "2024-03-01T09:00:00Z"
                    slot_duration: 60
                    time_between_slots: 15
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
                expandedSession:
                  summary: Session details with expand=teams,juries,rooms,summary
                  value:
                    id: 1
                    label: Morning Session
                    start_time: "2024-03-01T09:00:00Z"
                    slot_duration: 60
                    time_between_slots: 15
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
                    teams:
                      - id: 1
                        label: Team Alpha
                      - id: 2
                        label: Team Beta
                    juries:
                      - id: 1
                        label: Dr. John Smith
                    rooms:
                      - id: 1
                        label: Room 101
                      - id: 2
                        label: Room 102
                    room_sessions_count: 4
                    first_room_session_start_time: "2024-03-01T09:00:00Z"
                    last_room_session_end_time: "2024-03-01T12:00:00Z"
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Session not found
          content:
            text/plain:
              schema:
                type: string

    put:
      tags:
        - Sessions
      summary: Update an existing session with optional scope relations
      description: |
        Updates a session with the provided information. The ID is provided in the URL path, not in the request body.

        **Scope Relations (Optional):**
        You can optionally include `team_ids`, `jury_ids`, and `room_ids` arrays to manage session-level scope relations:
        - When these arrays are provided, the session's scope relations are replaced transactionally
        - Validates that all referenced IDs exist (returns 500 if not found)
        - Prevents removing teams/juries/rooms that are used in room_sessions (returns 409 Conflict)
        - Use `force: true` to override conflict protection and delete affected room_session relationships

        **Backward Compatibility:**
        If `team_ids`, `jury_ids`, and `room_ids` are omitted, the endpoint behaves like the old simple update (only updates core session fields).
      operationId: updateSession
      parameters:
        - name: id
          in: path
          required: true
          description: Session ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SessionUpdateRequest'
            examples:
              basicUpdate:
                summary: Basic update (backward compatible)
                value:
                  label: Morning Session Updated
                  start_time: "2024-03-01T09:30:00Z"
                  slot_duration: 90
                  time_between_slots: 20
              updateWithScope:
                summary: Update with scope relations
                value:
                  label: Morning Session Updated
                  start_time: "2024-03-01T09:30:00Z"
                  slot_duration: 90
                  time_between_slots: 20
                  team_ids: [1, 2, 3]
                  jury_ids: [1, 2]
                  room_ids: [1, 2]
              updateWithForce:
                summary: Update with force to remove used entities
                value:
                  label: Morning Session Updated
                  start_time: "2024-03-01T09:30:00Z"
                  slot_duration: 90
                  time_between_slots: 20
                  team_ids: [1]
                  jury_ids: []
                  room_ids: [1]
                  force: true
      responses:
        '200':
          description: Session updated successfully
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/Session'
                  - $ref: '#/components/schemas/SessionExpanded'
              examples:
                basicUpdate:
                  summary: Basic update response
                  value:
                    id: 1
                    label: Morning Session Updated
                    start_time: "2024-03-01T09:30:00Z"
                    slot_duration: 90
                    time_between_slots: 20
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T12:00:00Z"
                expandedUpdate:
                  summary: Update with scope relations response
                  value:
                    id: 1
                    label: Morning Session Updated
                    start_time: "2024-03-01T09:30:00Z"
                    slot_duration: 90
                    time_between_slots: 20
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T12:00:00Z"
                    teams:
                      - id: 1
                        label: Team Alpha
                      - id: 2
                        label: Team Beta
                    juries:
                      - id: 1
                        label: Dr. Smith
                    rooms:
                      - id: 1
                        label: Room 101
                      - id: 2
                        label: Room 102
        '400':
          description: Invalid request body or ID parameter
          content:
            text/plain:
              schema:
                type: string
        '409':
          description: Conflict - cannot remove teams/juries/rooms that are used in room sessions (use force=true to override)
          content:
            text/plain:
              schema:
                type: string
              example: "cannot remove teams that are used in room sessions (use force=true to override)"
        '500':
          description: Internal server error or validation error (e.g., non-existent team/jury/room IDs)
          content:
            text/plain:
              schema:
                type: string

    delete:
      tags:
        - Sessions
      summary: Delete a session
      description: Deletes a specific session by its ID
      operationId: deleteSession
      parameters:
        - name: id
          in: path
          required: true
          description: Session ID
          schema:
            type: integer
            example: 1
      responses:
        '204':
          description: Session deleted successfully
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/sessions/{id}/plan:
    post:
      tags:
        - Sessions
      summary: Save a full session plan
      description: |
        Saves a complete session plan including session-level links (rooms, teams, juries) and slots.
        Validates that all IDs exist and that slot team/jury IDs are subsets of the session selections.
        Persists transactionally: upserts session_rooms/session_teams/session_juries, creates/updates room_sessions,
        and creates room_session_teams and room_session_juries rows.
      operationId: saveSessionPlan
      parameters:
        - name: id
          in: path
          required: true
          description: Session ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SessionPlan'
            examples:
              sessionPlan:
                summary: Example session plan
                value:
                  room_ids: [1, 2]
                  team_ids: [1, 2, 3, 4]
                  jury_ids: [1, 2]
                  teams_per_room: 2
                  juries_per_room: 1
                  slots:
                    - room_id: 1
                      start_time: "2024-03-01T09:00:00Z"
                      end_time: "2024-03-01T10:00:00Z"
                      team_ids: [1, 2]
                      jury_ids: [1]
                    - room_id: 2
                      start_time: "2024-03-01T09:00:00Z"
                      end_time: "2024-03-01T10:00:00Z"
                      team_ids: [3, 4]
                      jury_ids: [2]
      responses:
        '200':
          description: Session plan saved successfully
          content:
            text/plain:
              schema:
                type: string
                example: Session plan saved successfully
        '400':
          description: Invalid request body or ID parameter
          content:
            text/plain:
              schema:
                type: string
        '409':
          description: |
            Scheduling constraint violated. This occurs when:
            - A team is assigned to multiple slots within the session
            - A jury is assigned to overlapping time ranges within the session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchedulingConflictError'
        '500':
          description: Internal server error (e.g., validation failed, IDs not found)
          content:
            text/plain:
              schema:
                type: string

  /api/sessions/{id}/rebalance:
    post:
      tags:
        - Sessions
      summary: Rebalance a session plan
      description: |
        Accepts a draft session plan and returns a rebalanced plan without persisting.
        Uses historical analytics data (team meetings, waiting times, room usage, jury interactions)
        to optimize the assignment of teams and juries to slots.

        The algorithm is deterministic (seeded with session_id) and respects constraints:
        - Each team appears at most once in the plan
        - No jury is assigned to overlapping time intervals
        - Only teams/juries/rooms in the session scope are used

        Optimization priorities:
        1. Reduce waiting-time disparity (teams with high wait get earlier slots)
        2. Increase rare meetings (group teams that historically met least)
        3. Jury stability + fairness (room-anchored juries, minimize repeat interactions)
        4. Room diversity (penalize frequent room usage by teams)
      operationId: rebalanceSessionPlan
      parameters:
        - name: id
          in: path
          required: true
          description: Session ID (used as seed for deterministic algorithm)
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SessionPlan'
            examples:
              sessionPlan:
                summary: Example session plan to rebalance
                value:
                  room_ids: [1, 2]
                  team_ids: [1, 2, 3, 4]
                  jury_ids: [1, 2]
                  teams_per_room: 2
                  juries_per_room: 1
                  slots:
                    - room_id: 1
                      start_time: "2024-03-01T09:00:00Z"
                      end_time: "2024-03-01T10:00:00Z"
                      team_ids: [1, 2]
                      jury_ids: [1]
                    - room_id: 2
                      start_time: "2024-03-01T09:00:00Z"
                      end_time: "2024-03-01T10:00:00Z"
                      team_ids: [3, 4]
                      jury_ids: [2]
      responses:
        '200':
          description: Successfully rebalanced plan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RebalancePlanResponse'
        '400':
          description: Invalid request body, ID parameter, or plan scope violation
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/sessions/{id}/export.pdf:
    get:
      tags:
        - Sessions
      summary: Export session plan as PDF
      description: |
        Generates a PDF document summarizing the session plan.

        The PDF includes:
        - Session label
        - Date/time (EU format: DD/MM/YYYY HH:MM)
        - Slot duration and gap between slots
        - Table grouped by room with each slot showing:
          - Start-end time
          - Assigned teams
          - Assigned juries

        The document is formatted for A4 paper with header and page numbers.
      operationId: exportSessionPDF
      parameters:
        - name: id
          in: path
          required: true
          description: Session ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: PDF document generated successfully
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Session not found
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/sessions/{id}/room-sessions:
    post:
      tags:
        - Sessions
      summary: Create a room session for a session (Preferred)
      description: |
        **This is the preferred endpoint for creating room sessions scoped to a session.**

        Creates a new room session for a specific session, associating teams and juries.
        - Validates that the room exists
        - Validates that team_ids and jury_ids belong to the parent session
        - Creates the room session with the specified parameters
        - Associates teams and juries with the room session
        - Returns the expanded room session (with room, session, teams, juries)

        **Note:** For backward compatibility, the legacy /api/room-sessions endpoint is still available.
      operationId: createRoomSessionForSession
      parameters:
        - name: id
          in: path
          required: true
          description: Session ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - room_id
                - start_time
                - end_time
              properties:
                room_id:
                  type: integer
                  description: ID of the room
                  example: 1
                start_time:
                  type: string
                  format: date-time
                  description: Start time of the room session
                  example: "2024-03-01T09:00:00Z"
                end_time:
                  type: string
                  format: date-time
                  description: End time of the room session
                  example: "2024-03-01T10:00:00Z"
                team_ids:
                  type: array
                  items:
                    type: integer
                  description: IDs of teams to associate with the room session (must be associated with the parent session)
                  example: [1, 2]
                jury_ids:
                  type: array
                  items:
                    type: integer
                  description: IDs of juries to associate with the room session (must be associated with the parent session)
                  example: [1]
            examples:
              roomSessionWithRelations:
                summary: Room session with teams and juries
                value:
                  room_id: 1
                  start_time: "2024-03-01T09:00:00Z"
                  end_time: "2024-03-01T10:00:00Z"
                  team_ids: [1, 2]
                  jury_ids: [1]
      responses:
        '201':
          description: Room session created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoomSessionExpanded'
              examples:
                roomSessionCreated:
                  summary: Room session created
                  value:
                    id: 1
                    room_id: 1
                    session_id: 1
                    start_time: "2024-03-01T09:00:00Z"
                    end_time: "2024-03-01T10:00:00Z"
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
                    room:
                      id: 1
                      label: "Room 101"
                    session:
                      id: 1
                      label: "Morning Session"
                    teams:
                      - id: 1
                        label: "Team Alpha"
                      - id: 2
                        label: "Team Beta"
                    juries:
                      - id: 1
                        label: "Jury Smith"
        '400':
          description: Invalid request body or validation failure
          content:
            text/plain:
              schema:
                type: string
        '409':
          description: |
            Scheduling constraint violated. This occurs when:
            - A team is already assigned to another room session within the same session
            - A jury is already assigned to an overlapping time range within the same session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchedulingConflictError'
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/sessions/{id}/room-sessions/{roomSessionId}:
    put:
      tags:
        - Sessions
      summary: Update a room session for a session (Preferred)
      description: |
        **This is the preferred endpoint for updating room sessions scoped to a session.**

        Updates an existing room session that belongs to a specific session.
        - Verifies that the room session belongs to the specified session
        - Validates that the room exists
        - Validates that team_ids and jury_ids belong to the parent session
        - Updates the room session with the specified parameters
        - Performs a transactional replace of teams and juries associations
        - Returns the expanded room session (with room, session, teams, juries)

        **Note:** For backward compatibility, the legacy /api/room-sessions/{id} endpoint is still available.
      operationId: updateRoomSessionForSession
      parameters:
        - name: id
          in: path
          required: true
          description: Session ID
          schema:
            type: integer
            example: 1
        - name: roomSessionId
          in: path
          required: true
          description: Room session ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - room_id
                - start_time
                - end_time
              properties:
                room_id:
                  type: integer
                  description: ID of the room
                  example: 1
                start_time:
                  type: string
                  format: date-time
                  description: Start time of the room session
                  example: "2024-03-01T09:00:00Z"
                end_time:
                  type: string
                  format: date-time
                  description: End time of the room session
                  example: "2024-03-01T10:00:00Z"
                team_ids:
                  type: array
                  items:
                    type: integer
                  description: IDs of teams to associate with the room session (must be associated with the parent session)
                  example: [1, 2, 3]
                jury_ids:
                  type: array
                  items:
                    type: integer
                  description: IDs of juries to associate with the room session (must be associated with the parent session)
                  example: [1, 2]
            examples:
              roomSessionUpdate:
                summary: Updated room session
                value:
                  room_id: 1
                  start_time: "2024-03-01T09:30:00Z"
                  end_time: "2024-03-01T10:30:00Z"
                  team_ids: [1, 2, 3]
                  jury_ids: [1, 2]
      responses:
        '200':
          description: Room session updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoomSessionExpanded'
              examples:
                roomSessionUpdated:
                  summary: Room session updated
                  value:
                    id: 1
                    room_id: 1
                    session_id: 1
                    start_time: "2024-03-01T09:30:00Z"
                    end_time: "2024-03-01T10:30:00Z"
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T12:00:00Z"
                    room:
                      id: 1
                      label: "Room 101"
                    session:
                      id: 1
                      label: "Morning Session"
                    teams:
                      - id: 1
                        label: "Team Alpha"
                      - id: 2
                        label: "Team Beta"
                      - id: 3
                        label: "Team Gamma"
                    juries:
                      - id: 1
                        label: "Jury Smith"
                      - id: 2
                        label: "Jury Jones"
        '400':
          description: Invalid request body, validation failure, or room session doesn't belong to session
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Room session not found
          content:
            text/plain:
              schema:
                type: string
        '409':
          description: |
            Scheduling constraint violated. This occurs when:
            - A team is already assigned to another room session within the same session
            - A jury is already assigned to an overlapping time range within the same session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchedulingConflictError'
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    delete:
      tags:
        - Sessions
      summary: Delete a room session for a session (Preferred)
      description: |
        **This is the preferred endpoint for deleting room sessions scoped to a session.**

        Deletes a room session that belongs to a specific session.
        - Verifies that the room session belongs to the specified session
        - Deletes the room session and all associated relationships (teams, juries)

        **Note:** For backward compatibility, the legacy /api/room-sessions/{id} endpoint is still available.
      operationId: deleteRoomSessionForSession
      parameters:
        - name: id
          in: path
          required: true
          description: Session ID
          schema:
            type: integer
            example: 1
        - name: roomSessionId
          in: path
          required: true
          description: Room session ID
          schema:
            type: integer
            example: 1
      responses:
        '204':
          description: Room session deleted successfully
        '400':
          description: Invalid ID parameter or room session doesn't belong to session
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Room session not found
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/room-sessions:
    post:
      tags:
        - Room Sessions
      summary: Create a new room session (Legacy - use /api/sessions/{id}/room-sessions instead)
      description: |
        **Legacy endpoint - for new development, prefer /api/sessions/{id}/room-sessions**

        Creates a new room session linking a room to a session with optional teams and juries.

        When team_ids or jury_ids are provided:
        - Creates the room session
        - Associates teams and juries with the room session
        - Automatically upserts into session_teams, session_juries, and session_rooms if the entities are not already linked to the parent session
        - Returns the room session with expanded data (room, session, teams, juries)

        When team_ids and jury_ids are not provided:
        - Creates a basic room session (backward compatible)
        - Returns the room session without expanded data
      operationId: createRoomSession
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoomSessionInput'
            examples:
              basicRoomSession:
                summary: Basic room session (backward compatible)
                value:
                  room_id: 1
                  session_id: 1
                  start_time: "2024-03-01T09:00:00Z"
                  end_time: "2024-03-01T10:00:00Z"
              roomSessionWithRelations:
                summary: Room session with teams and juries
                value:
                  room_id: 1
                  session_id: 1
                  start_time: "2024-03-01T09:00:00Z"
                  end_time: "2024-03-01T10:00:00Z"
                  team_ids: [1, 2]
                  jury_ids: [1]
      responses:
        '201':
          description: Room session created successfully
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/RoomSession'
                  - $ref: '#/components/schemas/RoomSessionExpanded'
              examples:
                basicRoomSession:
                  summary: Basic room session created
                  value:
                    id: 1
                    room_id: 1
                    session_id: 1
                    start_time: "2024-03-01T09:00:00Z"
                    end_time: "2024-03-01T10:00:00Z"
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
                roomSessionWithRelations:
                  summary: Room session with relations created
                  value:
                    id: 1
                    room_id: 1
                    session_id: 1
                    start_time: "2024-03-01T09:00:00Z"
                    end_time: "2024-03-01T10:00:00Z"
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
                    room:
                      id: 1
                      label: "Room 101"
                    session:
                      id: 1
                      label: "Morning Session"
                    teams:
                      - id: 1
                        label: "Team Alpha"
                      - id: 2
                        label: "Team Beta"
                    juries:
                      - id: 1
                        label: "Jury Smith"
        '400':
          description: Invalid request body
          content:
            text/plain:
              schema:
                type: string
        '409':
          description: |
            Scheduling constraint violated. This occurs when:
            - A team is already assigned to another room session within the same session
            - A jury is already assigned to an overlapping time range within the same session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchedulingConflictError'
              example:
                message: "scheduling constraints violated"
                conflicts:
                  - type: "team_duplicate"
                    entity_id: 5
                    conflicting_room_session_ids: [12, 15]
                    time_ranges:
                      - start_time: "2024-03-01T09:00:00Z"
                        end_time: "2024-03-01T10:00:00Z"
                  - type: "jury_time_overlap"
                    entity_id: 3
                    conflicting_room_session_ids: [14]
                    time_ranges:
                      - start_time: "2024-03-01T09:30:00Z"
                        end_time: "2024-03-01T10:30:00Z"
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    get:
      tags:
        - Room Sessions
      summary: Get all room sessions
      description: |
        Retrieves a list of all room sessions. Optionally expand related entities using the expand parameter.

        The expand parameter accepts comma-separated values to include related data:
        - `room`: Include room details (id and label)
        - `session`: Include session details (id and label)
        - `teams`: Include teams associated with the room session
        - `juries`: Include juries associated with the room session
      operationId: getAllRoomSessions
      parameters:
        - name: expand
          in: query
          required: false
          description: Comma-separated list of related entities to expand (room, session, teams, juries)
          schema:
            type: string
            example: "room,session,teams,juries"
      responses:
        '200':
          description: List of room sessions
          content:
            application/json:
              schema:
                type: array
                items:
                  oneOf:
                    - $ref: '#/components/schemas/RoomSession'
                    - $ref: '#/components/schemas/RoomSessionExpanded'
              examples:
                roomSessions:
                  summary: List of room sessions (no expand)
                  value:
                    - id: 1
                      room_id: 1
                      session_id: 1
                      start_time: "2024-03-01T09:00:00Z"
                      end_time: "2024-03-01T10:00:00Z"
                      created_at: "2024-03-01T08:00:00Z"
                      updated_at: "2024-03-01T08:00:00Z"
                    - id: 2
                      room_id: 2
                      session_id: 2
                      start_time: "2024-03-01T10:00:00Z"
                      end_time: "2024-03-01T11:00:00Z"
                      created_at: "2024-03-01T08:00:00Z"
                      updated_at: "2024-03-01T08:00:00Z"
                roomSessionsExpanded:
                  summary: List of room sessions with expand
                  value:
                    - id: 1
                      room_id: 1
                      session_id: 1
                      start_time: "2024-03-01T09:00:00Z"
                      end_time: "2024-03-01T10:00:00Z"
                      created_at: "2024-03-01T08:00:00Z"
                      updated_at: "2024-03-01T08:00:00Z"
                      room:
                        id: 1
                        label: "Room 101"
                      session:
                        id: 1
                        label: "Morning Session"
                      teams:
                        - id: 1
                          label: "Team Alpha"
                        - id: 2
                          label: "Team Beta"
                      juries:
                        - id: 1
                          label: "Jury Smith"
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/room-sessions/{id}:
    get:
      tags:
        - Room Sessions
      summary: Get a room session by ID
      description: |
        Retrieves a specific room session by its ID. Optionally expand related entities using the expand parameter.

        The expand parameter accepts comma-separated values to include related data:
        - `room`: Include room details (id and label)
        - `session`: Include session details (id and label)
        - `teams`: Include teams associated with the room session
        - `juries`: Include juries associated with the room session
      operationId: getRoomSessionById
      parameters:
        - name: id
          in: path
          required: true
          description: Room session ID
          schema:
            type: integer
            example: 1
        - name: expand
          in: query
          required: false
          description: Comma-separated list of related entities to expand (room, session, teams, juries)
          schema:
            type: string
            example: "room,session,teams,juries"
      responses:
        '200':
          description: Room session found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/RoomSession'
                  - $ref: '#/components/schemas/RoomSessionExpanded'
              examples:
                roomSession:
                  summary: Room session details (no expand)
                  value:
                    id: 1
                    room_id: 1
                    session_id: 1
                    start_time: "2024-03-01T09:00:00Z"
                    end_time: "2024-03-01T10:00:00Z"
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
                roomSessionExpanded:
                  summary: Room session details with expand
                  value:
                    id: 1
                    room_id: 1
                    session_id: 1
                    start_time: "2024-03-01T09:00:00Z"
                    end_time: "2024-03-01T10:00:00Z"
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T08:00:00Z"
                    room:
                      id: 1
                      label: "Room 101"
                    session:
                      id: 1
                      label: "Morning Session"
                    teams:
                      - id: 1
                        label: "Team Alpha"
                      - id: 2
                        label: "Team Beta"
                    juries:
                      - id: 1
                        label: "Jury Smith"
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Room session not found
          content:
            text/plain:
              schema:
                type: string

    delete:
      tags:
        - Room Sessions
      summary: Delete a room session (Legacy - use /api/sessions/{id}/room-sessions/{roomSessionId} instead)
      description: |
        **Legacy endpoint - for new development, prefer /api/sessions/{id}/room-sessions/{roomSessionId}**

        Deletes a specific room session by its ID
      operationId: deleteRoomSession
      parameters:
        - name: id
          in: path
          required: true
          description: Room session ID
          schema:
            type: integer
            example: 1
      responses:
        '204':
          description: Room session deleted successfully
        '400':
          description: Invalid ID parameter
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

    put:
      tags:
        - Room Sessions
      summary: Update a room session (Legacy - use /api/sessions/{id}/room-sessions/{roomSessionId} instead)
      description: |
        **Legacy endpoint - for new development, prefer /api/sessions/{id}/room-sessions/{roomSessionId}**

        Updates a room session with new room/time and replaces team/jury assignments in a transaction.

        This endpoint:
        - Updates the room session with new room_id, session_id, start_time, and end_time
        - Replaces all team and jury associations (removes old ones, adds new ones)
        - Automatically upserts into session_teams, session_juries, and session_rooms if the entities are not already linked to the parent session
        - Returns the updated room session with expanded data (room, session, teams, juries)
      operationId: updateRoomSession
      parameters:
        - name: id
          in: path
          required: true
          description: Room session ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoomSessionUpdateInput'
            examples:
              updateRoomSession:
                summary: Update room session
                value:
                  room_id: 2
                  session_id: 1
                  start_time: "2024-03-01T10:00:00Z"
                  end_time: "2024-03-01T11:00:00Z"
                  team_ids: [3, 4]
                  jury_ids: [2]
      responses:
        '200':
          description: Room session updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoomSessionExpanded'
              examples:
                updatedRoomSession:
                  summary: Updated room session with relations
                  value:
                    id: 1
                    room_id: 2
                    session_id: 1
                    start_time: "2024-03-01T10:00:00Z"
                    end_time: "2024-03-01T11:00:00Z"
                    created_at: "2024-03-01T08:00:00Z"
                    updated_at: "2024-03-01T12:00:00Z"
                    room:
                      id: 2
                      label: "Room 102"
                    session:
                      id: 1
                      label: "Morning Session"
                    teams:
                      - id: 3
                        label: "Team Gamma"
                      - id: 4
                        label: "Team Delta"
                    juries:
                      - id: 2
                        label: "Jury Jones"
        '400':
          description: Invalid request body or ID parameter
          content:
            text/plain:
              schema:
                type: string
        '404':
          description: Room session not found
          content:
            text/plain:
              schema:
                type: string
        '409':
          description: |
            Scheduling constraint violated. This occurs when:
            - A team is already assigned to another room session within the same session
            - A jury is already assigned to an overlapping time range within the same session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchedulingConflictError'
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/scheduling/schedule:
    post:
      tags:
        - Scheduling
      summary: Trigger scheduling
      description: Triggers the scheduling algorithm (placeholder implementation)
      operationId: scheduleSessions
      responses:
        '200':
          description: Scheduling executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Scheduling placeholder executed
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/scheduling/optimize:
    post:
      tags:
        - Scheduling
      summary: Trigger optimization
      description: Triggers the schedule optimization algorithm (placeholder implementation)
      operationId: optimizeSchedule
      responses:
        '200':
          description: Optimization executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Optimization placeholder executed
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/analytics/report:
    get:
      tags:
        - Analytics
      summary: Get analytics report
      description: Generates an analytics report (placeholder implementation)
      operationId: getAnalyticsReport
      responses:
        '200':
          description: Analytics report generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  report:
                    type: string
                    example: Analytics report placeholder
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/analytics/metrics:
    get:
      tags:
        - Analytics
      summary: Get metrics
      description: Retrieves system metrics (placeholder implementation)
      operationId: getMetrics
      responses:
        '200':
          description: Metrics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
                example:
                  metric1: value1
                  metric2: value2
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/analytics/summary:
    get:
      tags:
        - Analytics
      summary: Get analytics summary
      description: |
        Returns analytics summary with competition fairness metrics including:
        - Team-vs-team matrix: count how many times each pair of teams met in the same room session
        - Team waiting times: total and average waiting time between session start and first room session, with per-session breakdown
        - Team room distributions: count of room sessions per room for each team
        - Team-jury matrix: count how many times each team and jury were assigned together in room sessions, with per-team and per-jury totals

        Supports optional filtering by session_id or date range.
      operationId: getAnalyticsSummary
      parameters:
        - name: session_id
          in: query
          description: Filter results by a specific session ID
          required: false
          schema:
            type: integer
            example: 1
        - name: start_date
          in: query
          description: Filter results by start date (ISO 8601 timestamp)
          required: false
          schema:
            type: string
            format: date-time
            example: "2024-03-01T00:00:00Z"
        - name: end_date
          in: query
          description: Filter results by end date (ISO 8601 timestamp)
          required: false
          schema:
            type: string
            format: date-time
            example: "2024-03-31T23:59:59Z"
      responses:
        '200':
          description: Analytics summary retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyticsSummary'
        '400':
          description: Invalid request parameters
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string

  /api/import/session-document/parse:
    post:
      tags:
        - Import
      summary: Parse PDF session schedule
      description: |
        Parses a PDF file containing a session schedule table and returns a draft plan.
        The PDF should contain a table with rooms, times, and team codes.

        **Features:**
        - Deterministic text extraction (no OCR)
        - Normalizes whitespace while preserving UTF-8 characters
        - Extracts slot_duration from line "Dure et format de l'preuve : XX minutes"
        - Locates room header by finding all room labels from DB (in order, possibly on consecutive lines)
        - Reads time slots (lines starting with HH:MM) and following team labels
        - Extracts team labels using regex \b[A-Z]\d+\b
        - Groups teams by room (handles multi-line cells and comma continuations)
        - Derives time_between_slots from difference between first two start times minus duration
        - Resolves room/team labels to IDs from database (case-insensitive)
        - Auto-assigns juries round-robin with no overlap
        - Returns draft plan without writing to database

        **Required fields:**
        - `pdf`: PDF file (multipart/form-data)
        - `date` or `day`: Schedule date (YYYY-MM-DD)
        - `jury_ids[]`: Array of jury IDs to assign
        - `juries_per_room`: Number of juries per room

        **Optional fields:**
        - `session_label`: Label for the session
        - `slot_duration`: Duration of each slot in minutes (parsed from PDF if not provided)
        - `time_between_slots`: Gap between slots in minutes (derived from PDF if not provided)

        **Error Handling:**
        - If parsed room or team labels are not found in database, returns HTTP 400 with structured error including missing labels and extracted schedule context
      operationId: parseSessionDocument
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - pdf
                - date
                - jury_ids
                - juries_per_room
              properties:
                pdf:
                  type: string
                  format: binary
                  description: PDF file containing the session schedule
                session_label:
                  type: string
                  description: Optional label for the session
                  example: "Spring 2024 Presentations"
                date:
                  type: string
                  format: date
                  description: Schedule date (YYYY-MM-DD)
                  example: "2024-03-15"
                day:
                  type: string
                  format: date
                  description: Alternative to 'date' field (YYYY-MM-DD)
                  example: "2024-03-15"
                slot_duration:
                  type: integer
                  description: Duration of each slot in minutes (optional - parsed from PDF if not provided)
                  example: 30
                time_between_slots:
                  type: integer
                  description: Gap between slots in minutes (optional - derived from PDF schedule if not provided)
                  example: 5
                jury_ids:
                  type: array
                  items:
                    type: integer
                  description: Array of jury IDs to assign to slots
                  example: [1, 2, 3, 4, 5]
                juries_per_room:
                  type: integer
                  description: Number of juries to assign per room
                  example: 2
      responses:
        '200':
          description: PDF parsed successfully, returns draft plan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DraftPlan'
              example:
                session_label: "Spring 2024 Presentations"
                date: "2024-03-15T00:00:00Z"
                slot_duration: 30
                time_between_slots: 5
                jury_ids: [1, 2, 3, 4, 5]
                juries_per_room: 2
                slots:
                  - room_id: 1
                    room_label: "Room A"
                    start_time: "2024-03-15T09:00:00Z"
                    end_time: "2024-03-15T09:30:00Z"
                    team_ids: [1, 2]
                    team_labels: ["T01", "T02"]
                    jury_ids: [1, 2]
                  - room_id: 2
                    room_label: "Room B"
                    start_time: "2024-03-15T09:00:00Z"
                    end_time: "2024-03-15T09:30:00Z"
                    team_ids: [3]
                    team_labels: ["T03"]
                    jury_ids: [3, 4]
        '400':
          description: Invalid request (missing required fields, invalid PDF, or missing rooms/teams in database)
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ImportError'
                  - type: string
              examples:
                missing_entities:
                  summary: Missing rooms or teams in database
                  value:
                    message: "Missing rooms or teams in database"
                    missing_rooms: ["Room C"]
                    missing_teams: ["T99", "T100"]
                    extracted_slots:
                      - room_label: "Room A"
                        start_time: "09:00"
                        end_time: "09:30"
                        team_labels: ["T01", "T02"]
                      - room_label: "Room C"
                        start_time: "09:00"
                        end_time: "09:30"
                        team_labels: ["T99"]
                invalid_field:
                  summary: Missing or invalid field
                  value: "date or day field is required"
        '422':
          description: PDF could not be parsed (no schedule data found)
          content:
            text/plain:
              schema:
                type: string
        '500':
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string


components:
  schemas:
    Team:
      type: object
      required:
        - id
        - label
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          description: Team ID
          example: 1
        label:
          type: string
          description: Team label
          example: Team Alpha
        created_at:
          type: string
          format: date-time
          description: Timestamp when the team was created
          example: "2024-03-01T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the team was last updated
          example: "2024-03-01T10:00:00Z"

    TeamInput:
      type: object
      required:
        - label
      properties:
        label:
          type: string
          description: Team label
          example: Team Alpha

    Room:
      type: object
      required:
        - id
        - label
        - max_size
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          description: Room ID
          example: 1
        label:
          type: string
          description: Room label
          example: Room 101
        max_size:
          type: integer
          description: Room maximum capacity (number of people)
          example: 30
        created_at:
          type: string
          format: date-time
          description: Timestamp when the room was created
          example: "2024-03-01T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the room was last updated
          example: "2024-03-01T10:00:00Z"

    RoomInput:
      type: object
      required:
        - label
        - max_size
      properties:
        label:
          type: string
          description: Room label
          example: Room 101
        max_size:
          type: integer
          description: Room maximum capacity (number of people)
          example: 30

    Jury:
      type: object
      required:
        - id
        - label
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          description: Jury ID
          example: 1
        label:
          type: string
          description: Jury member label
          example: Dr. John Smith
        created_at:
          type: string
          format: date-time
          description: Timestamp when the jury was created
          example: "2024-03-01T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the jury was last updated
          example: "2024-03-01T10:00:00Z"

    JuryInput:
      type: object
      required:
        - label
      properties:
        label:
          type: string
          description: Jury member label
          example: Dr. John Smith

    Session:
      type: object
      required:
        - id
        - label
        - start_time
        - slot_duration
        - time_between_slots
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          description: Session ID
          example: 1
        label:
          type: string
          description: Session label
          example: Morning Session
        start_time:
          type: string
          format: date-time
          description: Session start time
          example: "2024-03-01T09:00:00Z"
        slot_duration:
          type: integer
          description: Duration of each slot in minutes
          example: 60
        time_between_slots:
          type: integer
          description: Gap between slots in minutes
          example: 15
        created_at:
          type: string
          format: date-time
          description: Timestamp when the session was created
          example: "2024-03-01T08:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the session was last updated
          example: "2024-03-01T08:00:00Z"

    SessionInput:
      type: object
      required:
        - label
        - start_time
        - slot_duration
        - time_between_slots
      properties:
        label:
          type: string
          description: Session label
          example: Morning Session
        start_time:
          type: string
          format: date-time
          description: Session start time
          example: "2024-03-01T09:00:00Z"
        slot_duration:
          type: integer
          description: Duration of each slot in minutes
          example: 60
        time_between_slots:
          type: integer
          description: Gap between slots in minutes
          example: 15

    SessionUpdateRequest:
      type: object
      required:
        - label
        - start_time
        - slot_duration
        - time_between_slots
      properties:
        label:
          type: string
          description: Session label
          example: Morning Session
        start_time:
          type: string
          format: date-time
          description: Session start time
          example: "2024-03-01T09:00:00Z"
        slot_duration:
          type: integer
          description: Duration of each slot in minutes
          example: 60
        time_between_slots:
          type: integer
          description: Gap between slots in minutes
          example: 15
        team_ids:
          type: array
          items:
            type: integer
          description: Optional array of team IDs to link to this session. If provided, the session's teams will be replaced with this list.
          example: [1, 2, 3]
        jury_ids:
          type: array
          items:
            type: integer
          description: Optional array of jury IDs to link to this session. If provided, the session's juries will be replaced with this list.
          example: [1, 2]
        room_ids:
          type: array
          items:
            type: integer
          description: Optional array of room IDs to link to this session. If provided, the session's rooms will be replaced with this list.
          example: [1, 2, 3]
        force:
          type: boolean
          description: If true, allows removing teams/juries/rooms that are used in room sessions by also deleting the affected room_session relationships. If false or omitted, returns 409 Conflict when trying to remove used entities.
          example: false

    SessionExpanded:
      type: object
      required:
        - id
        - label
        - start_time
        - slot_duration
        - time_between_slots
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          description: Session ID
          example: 1
        label:
          type: string
          description: Session label
          example: Morning Session
        start_time:
          type: string
          format: date-time
          description: Session start time
          example: "2024-03-01T09:00:00Z"
        slot_duration:
          type: integer
          description: Duration of each slot in minutes
          example: 60
        time_between_slots:
          type: integer
          description: Gap between slots in minutes
          example: 15
        created_at:
          type: string
          format: date-time
          description: Timestamp when the session was created
          example: "2024-03-01T08:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the session was last updated
          example: "2024-03-01T08:00:00Z"
        teams:
          type: array
          description: Associated teams (present when expand=teams is used)
          items:
            $ref: '#/components/schemas/IDLabel'
          example:
            - id: 1
              label: Team Alpha
            - id: 2
              label: Team Beta
        juries:
          type: array
          description: Associated juries (present when expand=juries is used)
          items:
            $ref: '#/components/schemas/IDLabel'
          example:
            - id: 1
              label: Dr. John Smith
        rooms:
          type: array
          description: Associated rooms (present when expand=rooms is used)
          items:
            $ref: '#/components/schemas/IDLabel'
          example:
            - id: 1
              label: Room 101
            - id: 2
              label: Room 102
        room_sessions_count:
          type: integer
          description: Total count of room sessions associated with this session (present when expand=summary is used)
          example: 4
        first_room_session_start_time:
          type: string
          format: date-time
          description: Start time of the first room session (present when expand=summary is used)
          example: "2024-03-01T09:00:00Z"
        last_room_session_end_time:
          type: string
          format: date-time
          description: End time of the last room session (present when expand=summary is used)
          example: "2024-03-01T12:00:00Z"

    IDLabel:
      type: object
      required:
        - id
        - label
      properties:
        id:
          type: integer
          description: Entity ID
          example: 1
        label:
          type: string
          description: Entity label
          example: Team Alpha

    RoomSession:
      type: object
      required:
        - id
        - room_id
        - session_id
        - start_time
        - end_time
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          description: Room session ID
          example: 1
        room_id:
          type: integer
          description: ID of the room
          example: 1
        session_id:
          type: integer
          description: ID of the session
          example: 1
        start_time:
          type: string
          format: date-time
          description: Room session start time
          example: "2024-03-01T09:00:00Z"
        end_time:
          type: string
          format: date-time
          description: Room session end time
          example: "2024-03-01T10:00:00Z"
        created_at:
          type: string
          format: date-time
          description: Timestamp when the room session was created
          example: "2024-03-01T08:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the room session was last updated
          example: "2024-03-01T08:00:00Z"

    RoomSessionInput:
      type: object
      required:
        - room_id
        - session_id
        - start_time
        - end_time
      properties:
        room_id:
          type: integer
          description: ID of the room
          example: 1
        session_id:
          type: integer
          description: ID of the session
          example: 1
        start_time:
          type: string
          format: date-time
          description: Room session start time
          example: "2024-03-01T09:00:00Z"
        end_time:
          type: string
          format: date-time
          description: Room session end time
          example: "2024-03-01T10:00:00Z"
        team_ids:
          type: array
          items:
            type: integer
          description: Optional array of team IDs to associate with this room session
          example: [1, 2]
        jury_ids:
          type: array
          items:
            type: integer
          description: Optional array of jury IDs to associate with this room session
          example: [1]

    RoomSessionExpanded:
      type: object
      required:
        - id
        - room_id
        - session_id
        - start_time
        - end_time
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          description: Room session ID
          example: 1
        room_id:
          type: integer
          description: ID of the room
          example: 1
        session_id:
          type: integer
          description: ID of the session
          example: 1
        start_time:
          type: string
          format: date-time
          description: Room session start time
          example: "2024-03-01T09:00:00Z"
        end_time:
          type: string
          format: date-time
          description: Room session end time
          example: "2024-03-01T10:00:00Z"
        created_at:
          type: string
          format: date-time
          description: Timestamp when the room session was created
          example: "2024-03-01T08:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the room session was last updated
          example: "2024-03-01T08:00:00Z"
        room:
          $ref: '#/components/schemas/IDLabel'
        session:
          $ref: '#/components/schemas/IDLabel'
        teams:
          type: array
          items:
            $ref: '#/components/schemas/IDLabel'
          description: Teams associated with this room session
        juries:
          type: array
          items:
            $ref: '#/components/schemas/IDLabel'
          description: Juries associated with this room session

    RoomSessionUpdateInput:
      type: object
      required:
        - room_id
        - session_id
        - start_time
        - end_time
      properties:
        room_id:
          type: integer
          description: ID of the room
          example: 1
        session_id:
          type: integer
          description: ID of the session
          example: 1
        start_time:
          type: string
          format: date-time
          description: Room session start time
          example: "2024-03-01T09:00:00Z"
        end_time:
          type: string
          format: date-time
          description: Room session end time
          example: "2024-03-01T10:00:00Z"
        team_ids:
          type: array
          items:
            type: integer
          description: Array of team IDs to associate with this room session (replaces existing)
          example: [1, 2]
        jury_ids:
          type: array
          items:
            type: integer
          description: Array of jury IDs to associate with this room session (replaces existing)
          example: [1]

    SessionPlan:
      type: object
      required:
        - room_ids
        - team_ids
        - jury_ids
        - teams_per_room
        - juries_per_room
        - slots
      properties:
        room_ids:
          type: array
          items:
            type: integer
          description: IDs of rooms associated with the session
          example: [1, 2]
        team_ids:
          type: array
          items:
            type: integer
          description: IDs of teams associated with the session
          example: [1, 2, 3, 4]
        jury_ids:
          type: array
          items:
            type: integer
          description: IDs of juries associated with the session
          example: [1, 2]
        teams_per_room:
          type: integer
          description: Number of teams per room
          example: 2
        juries_per_room:
          type: integer
          description: Number of juries per room
          example: 1
        slots:
          type: array
          items:
            $ref: '#/components/schemas/SessionPlanSlot'
          description: Array of time slots with room, team, and jury assignments

    SessionPlanSlot:
      type: object
      required:
        - room_id
        - start_time
        - end_time
        - team_ids
        - jury_ids
      properties:
        room_id:
          type: integer
          description: ID of the room for this slot
          example: 1
        start_time:
          type: string
          format: date-time
          description: Slot start time
          example: "2024-03-01T09:00:00Z"
        end_time:
          type: string
          format: date-time
          description: Slot end time
          example: "2024-03-01T10:00:00Z"
        team_ids:
          type: array
          items:
            type: integer
          description: IDs of teams assigned to this slot (must be subset of session team_ids)
          example: [1, 2]
        jury_ids:
          type: array
          items:
            type: integer
          description: IDs of juries assigned to this slot (must be subset of session jury_ids)
          example: [1]

    RebalanceScores:
      type: object
      required:
        - wait_disparity
        - meeting_repeats
        - team_jury_repeats
        - room_diversity
        - total_penalty
      properties:
        wait_disparity:
          type: number
          format: double
          description: Variance in waiting times across teams
          example: 125.5
        meeting_repeats:
          type: integer
          description: Sum of historical team_vs_team counts for teams grouped in same slots
          example: 3
        team_jury_repeats:
          type: integer
          description: Sum of historical team_jury counts for teams meeting juries
          example: 5
        room_diversity:
          type: number
          format: double
          description: Penalty for teams using frequently-used rooms
          example: 12.0
        total_penalty:
          type: number
          format: double
          description: Weighted sum of all penalty scores
          example: 250.75

    RebalanceReport:
      type: object
      required:
        - before_scores
        - after_scores
        - improved
        - iterations
      properties:
        before_scores:
          $ref: '#/components/schemas/RebalanceScores'
        after_scores:
          $ref: '#/components/schemas/RebalanceScores'
        improved:
          type: boolean
          description: Whether the rebalancing improved the total penalty score
          example: true
        iterations:
          type: integer
          description: Number of local improvement iterations performed
          example: 100

    RebalancePlanResponse:
      type: object
      required:
        - plan
      properties:
        plan:
          $ref: '#/components/schemas/SessionPlan'
        rebalance_report:
          $ref: '#/components/schemas/RebalanceReport'

    SchedulingConflictType:
      type: string
      enum:
        - team_duplicate
        - jury_time_overlap
      description: |
        Type of scheduling constraint violation:
        * `team_duplicate` - A team can appear at most once within a given session
        * `jury_time_overlap` - A jury cannot be assigned to overlapping time ranges

    TimeRange:
      type: object
      required:
        - start_time
        - end_time
      properties:
        start_time:
          type: string
          format: date-time
          description: Start time of the time range
          example: "2024-03-01T10:00:00Z"
        end_time:
          type: string
          format: date-time
          description: End time of the time range
          example: "2024-03-01T11:00:00Z"

    SchedulingConflict:
      type: object
      required:
        - type
        - entity_id
        - conflicting_room_session_ids
      properties:
        type:
          $ref: '#/components/schemas/SchedulingConflictType'
        entity_id:
          type: integer
          description: ID of the entity (team or jury) that violates the constraint
          example: 5
        conflicting_room_session_ids:
          type: array
          items:
            type: integer
          description: IDs of room sessions that conflict with the proposed change
          example: [12, 15]
        time_ranges:
          type: array
          items:
            $ref: '#/components/schemas/TimeRange'
          description: Time ranges of the conflicting room sessions (only for time overlap conflicts)

    SchedulingConflictError:
      type: object
      required:
        - message
        - conflicts
      properties:
        message:
          type: string
          description: Human-readable error message
          example: "scheduling constraints violated"
        conflicts:
          type: array
          items:
            $ref: '#/components/schemas/SchedulingConflict'
          description: List of scheduling conflicts detected

    AnalyticsSummary:
      type: object
      required:
        - team_vs_team_matrix
        - team_waiting_times
        - team_room_distributions
        - team_jury_matrix
      properties:
        team_vs_team_matrix:
          type: array
          items:
            $ref: '#/components/schemas/TeamPairMeeting'
          description: Matrix showing how many times each pair of teams met in the same room session
        team_waiting_times:
          type: array
          items:
            $ref: '#/components/schemas/TeamWaitingTime'
          description: Waiting time statistics for each team
        team_room_distributions:
          type: array
          items:
            $ref: '#/components/schemas/TeamRoomDistribution'
          description: Room usage distribution for each team
        team_jury_matrix:
          $ref: '#/components/schemas/TeamJuryMatrix'
          description: Matrix showing how many times each team and jury were assigned together in room sessions

    TeamPairMeeting:
      type: object
      required:
        - team1_id
        - team1_label
        - team2_id
        - team2_label
        - meet_count
      properties:
        team1_id:
          type: integer
          description: ID of the first team
          example: 1
        team1_label:
          type: string
          description: Label of the first team
          example: "Team Alpha"
        team2_id:
          type: integer
          description: ID of the second team
          example: 2
        team2_label:
          type: string
          description: Label of the second team
          example: "Team Beta"
        meet_count:
          type: integer
          description: Number of times these two teams met in the same room session
          example: 3

    TeamWaitingTime:
      type: object
      required:
        - team_id
        - team_label
        - total_waiting_time_minutes
        - average_waiting_time_minutes
        - session_breakdown
      properties:
        team_id:
          type: integer
          description: Team ID
          example: 1
        team_label:
          type: string
          description: Team label
          example: "Team Alpha"
        total_waiting_time_minutes:
          type: number
          format: float
          description: Total waiting time across all sessions in minutes
          example: 45.5
        average_waiting_time_minutes:
          type: number
          format: float
          description: Average waiting time per session in minutes
          example: 22.75
        session_breakdown:
          type: array
          items:
            $ref: '#/components/schemas/SessionWaitingTime'
          description: Per-session breakdown of waiting times

    SessionWaitingTime:
      type: object
      required:
        - session_id
        - session_label
        - session_start_time
        - first_room_start_time
        - waiting_time_minutes
      properties:
        session_id:
          type: integer
          description: Session ID
          example: 1
        session_label:
          type: string
          description: Session label
          example: "Morning Session"
        session_start_time:
          type: string
          format: date-time
          description: When the session started
          example: "2024-03-01T09:00:00Z"
        first_room_start_time:
          type: string
          format: date-time
          description: When the team's first room session started
          example: "2024-03-01T09:30:00Z"
        waiting_time_minutes:
          type: number
          format: float
          description: Waiting time in minutes
          example: 30.0

    TeamRoomDistribution:
      type: object
      required:
        - team_id
        - team_label
        - room_counts
      properties:
        team_id:
          type: integer
          description: Team ID
          example: 1
        team_label:
          type: string
          description: Team label
          example: "Team Alpha"
        room_counts:
          type: array
          items:
            $ref: '#/components/schemas/RoomCount'
          description: Count of room sessions per room

    RoomCount:
      type: object
      required:
        - room_id
        - room_label
        - count
      properties:
        room_id:
          type: integer
          description: Room ID
          example: 1
        room_label:
          type: string
          description: Room label
          example: "Room 101"
        count:
          type: integer
          description: Number of room sessions this team had in this room
          example: 5

    TeamJuryMatrix:
      type: object
      required:
        - teams
        - juries
        - counts
        - per_team_totals
        - per_jury_totals
      properties:
        teams:
          type: array
          items:
            $ref: '#/components/schemas/TeamLabel'
          description: List of all teams that appear in the matrix
        juries:
          type: array
          items:
            $ref: '#/components/schemas/JuryLabel'
          description: List of all juries that appear in the matrix
        counts:
          type: array
          items:
            $ref: '#/components/schemas/TeamJuryInteraction'
          description: List of team-jury interaction counts
        per_team_totals:
          type: object
          additionalProperties:
            type: integer
          description: Total number of room sessions per team (key is team ID)
          example:
            "1": 5
            "2": 3
        per_jury_totals:
          type: object
          additionalProperties:
            type: integer
          description: Total number of room sessions per jury (key is jury ID)
          example:
            "1": 4
            "2": 6

    TeamLabel:
      type: object
      required:
        - id
        - label
      properties:
        id:
          type: integer
          description: Team ID
          example: 1
        label:
          type: string
          description: Team label
          example: "Team Alpha"

    JuryLabel:
      type: object
      required:
        - id
        - label
      properties:
        id:
          type: integer
          description: Jury ID
          example: 1
        label:
          type: string
          description: Jury label
          example: "Dr. Smith"

    TeamJuryInteraction:
      type: object
      required:
        - team_id
        - team_label
        - jury_id
        - jury_label
        - meet_count
      properties:
        team_id:
          type: integer
          description: Team ID
          example: 1
        team_label:
          type: string
          description: Team label
          example: "Team Alpha"
        jury_id:
          type: integer
          description: Jury ID
          example: 1
        jury_label:
          type: string
          description: Jury label
          example: "Dr. Smith"
        meet_count:
          type: integer
          description: Number of room sessions where this team and jury were assigned together
          example: 2


    DraftPlan:
      type: object
      required:
        - date
        - slot_duration
        - time_between_slots
        - jury_ids
        - juries_per_room
        - slots
      properties:
        session_label:
          type: string
          description: Optional label for the session
          example: "Spring 2024 Presentations"
        date:
          type: string
          format: date-time
          description: Schedule date
          example: "2024-03-15T00:00:00Z"
        slot_duration:
          type: integer
          description: Duration of each slot in minutes
          example: 30
        time_between_slots:
          type: integer
          description: Gap between slots in minutes
          example: 5
        jury_ids:
          type: array
          items:
            type: integer
          description: Array of jury IDs available for assignment
          example: [1, 2, 3, 4, 5]
        juries_per_room:
          type: integer
          description: Number of juries to assign per room
          example: 2
        slots:
          type: array
          items:
            $ref: '#/components/schemas/DraftPlanSlot'
          description: Array of schedule slots with room, time, teams, and assigned juries

    DraftPlanSlot:
      type: object
      required:
        - room_id
        - room_label
        - start_time
        - end_time
        - team_ids
        - team_labels
        - jury_ids
      properties:
        room_id:
          type: integer
          description: Room ID (resolved from database)
          example: 1
        room_label:
          type: string
          description: Room label/name (parsed from PDF)
          example: "Room A"
        start_time:
          type: string
          format: date-time
          description: Slot start time
          example: "2024-03-15T09:00:00Z"
        end_time:
          type: string
          format: date-time
          description: Slot end time
          example: "2024-03-15T09:30:00Z"
        team_ids:
          type: array
          items:
            type: integer
          description: Array of team IDs (resolved from database)
          example: [1, 2]
        team_labels:
          type: array
          items:
            type: string
          description: Array of team labels/codes (parsed from PDF)
          example: ["T01", "T02"]
        jury_ids:
          type: array
          items:
            type: integer
          description: Array of jury IDs assigned to this slot (auto-assigned round-robin)
          example: [1, 2]

    ImportError:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Error message
          example: "Missing rooms or teams in database"
        missing_rooms:
          type: array
          items:
            type: string
          description: Array of room labels that were not found in the database
          example: ["Room C", "Room D"]
        missing_teams:
          type: array
          items:
            type: string
          description: Array of team labels that were not found in the database
          example: ["T99", "T100"]
        extracted_slots:
          type: array
          items:
            $ref: '#/components/schemas/ExtractedSlotInfo'
          description: Context about what was extracted from the PDF

    ExtractedSlotInfo:
      type: object
      required:
        - room_label
        - start_time
        - end_time
        - team_labels
      properties:
        room_label:
          type: string
          description: Room label from PDF
          example: "Room A"
        start_time:
          type: string
          description: Slot start time (HH:MM format)
          example: "09:00"
        end_time:
          type: string
          description: Slot end time (HH:MM format)
          example: "09:30"
        team_labels:
          type: array
          items:
            type: string
          description: Team labels from PDF
          example: ["T01", "T02"]
